<!-- pulls in main layout and static files -->
{% extends "base.html" %}
{% load static %}
<!-- sets browser tab title -->
{% block title %}Keanu's Candy Store Shopping Cart{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px; margin: 2rem auto;">
    <h1>Keanu's Candy Store Shopping Cart</h1>

    <!-- if cart has items show table-->
    <!-- if cart is empty display message -->
    {% if cart|length > 0 %}
    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
        <thead>
            <tr style="border-bottom: 2px solid #ddd; text-align: left;">
                <th style="padding: 10px;">Product</th>
                <th style="padding: 10px;">Quantity</th>
                <th style="padding: 10px;">Unit Price</th>
                <th style="padding: 10px;">Price</th>
                <th style="padding: 10px;">Remove</th>
            </tr>
        </thead>
        <tbody>
            <!--  goes through each candy item in the cart -->
            {% for item in cart %}
            {% with product=item.product %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 10px;">
                    <!-- user can click on candy name to go to detail page -->
                    <a href="{% url 'candy_detail' product.id %}"
                        style="text-decoration: none; color: #333; font-weight: bold;">
                        {{ product.name }}
                    </a>
                </td>
                <td style="padding: 10px;">
                    <!-- allows user to change quantity of candy in cart -->
                    <form action="{% url 'cart:cart_add' product.id %}" method="post"
                        style="display: inline-flex; align-items: center;">
                        {% csrf_token %}
                        <input type="number" name="quantity" value="{{ item.quantity }}" min="1"
                            style="width: 60px; padding: 5px;" onchange="this.form.submit()">
                        <input type="hidden" name="override" value="True">
                    </form>
                </td>
                <!-- shows individual price of candy -->
                <td style="padding: 10px;">${{ item.price }}</td>
                <!-- shows total price of candy -->
                <td style="padding: 10px;">${{ item.total_price }}</td>
                <!-- allows user to remove candy from cart -->
                <td style="padding: 10px;">
                    <form action="{% url 'cart:cart_remove' product.id %}" method="post">
                        {% csrf_token %}
                        <button type="submit"
                            style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Remove</button>
                    </form>
                </td>
            </tr>
            {% endwith %}
            {% endfor %}
            <tr style="font-weight: bold; background-color: #f9f9f9;">
                <td colspan="3" style="padding: 10px; text-align: right;">Total:</td>
                <!-- show total price of all candies in cart -->
                <td colspan="2" style="padding: 10px;">${{ cart.get_total_price }}</td>
            </tr>
        </tbody>
    </table>

    <div style="margin-top: 20px; text-align: right;">
        <a href="{% url 'home' %}" class="btn"
            style="background-color: #6c757d; color: white; text-decoration: none; padding: 10px 20px; border-radius: 4px; margin-right: 10px;">Continue
            Shopping</a>
        <a href="{% url 'orders:order_create' %}" class="btn"
            style="background-color: #28a745; color: white; text-decoration: none; padding: 10px 20px; border-radius: 4px;">Checkout</a>
    </div>

    {% else %}
    <!-- if cart is empty display message -->
    <p>Your cart is empty</p>
    <a href="{% url 'home' %}" class="btn"
        style="background-color: #007bff; color: white; text-decoration: none; padding: 10px 20px; border-radius: 4px;">Go
        Shop</a>
    {% endif %}
</div>
{% endblock %}